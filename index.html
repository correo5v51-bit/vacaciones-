<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vacaciones Pro</title>
    
    <meta name="theme-color" content="#2563eb">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Vacaciones">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/correo5v51-bit/vacaciones-/main/10861844.png">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/correo5v51-bit/vacaciones-/main/10861844.png">
    
    <link rel="manifest" href="manifest.json">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .details-content { display: none; }
        .expanded .details-content { display: block; }
        .expanded .chevron { transform: rotate(180deg); }
        .antiquity-badge { background: #eff6ff; color: #2563eb; border-radius: 8px; padding: 4px 12px; font-weight: 700; font-size: 0.75rem; border: 1px solid #dbeafe; }
        
        .drawer { 
            transform: translateX(100%); 
            transition: transform 0.3s ease-in-out; 
            pointer-events: none;
        }
        .drawer.open { 
            transform: translateX(0); 
            pointer-events: auto;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-24">

    <nav class="bg-white border-b border-slate-200 px-4 py-3 sticky top-0 z-30">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <h1 class="text-lg font-bold text-slate-800">Vacaciones Pro üå¥</h1>
            <button onclick="toggleSettings(true)" class="p-2 bg-slate-100 rounded-full">‚öôÔ∏è</button>
        </div>
    </nav>

    <div class="max-w-md mx-auto px-4 pt-6">
        <header class="mb-6">
            <div id="antiquityDisplay" class="flex gap-2 items-center hidden">
                <span id="antYears" class="antiquity-badge">0a</span>
                <span id="antMonths" class="antiquity-badge">0m</span>
                <span id="antDays" class="antiquity-badge">0d</span>
            </div>
        </header>

        <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200 mb-6 grid grid-cols-2 gap-4">
            <div>
                <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Fecha Ingreso</label>
                <input type="date" id="hireDate" onchange="saveData()" class="text-sm font-semibold text-slate-700 w-full bg-slate-50 rounded-lg p-2 outline-none">
            </div>
            <div>
                <label class="block text-[10px] font-bold text-amber-600 uppercase mb-1">D√≠as A√±o Ant.</label>
                <input type="number" id="prevYearDays" value="0" step="0.5" onchange="saveData()" class="text-sm font-semibold text-amber-700 w-full bg-amber-50 rounded-lg p-2 outline-none">
            </div>
        </div>

        <div id="accrualBanner" class="hidden mb-6 text-white">
            <div class="bg-gradient-to-br from-blue-600 to-indigo-700 p-5 rounded-3xl shadow-xl">
                <div class="grid grid-cols-2 gap-0 divide-x divide-white/20">
                    <div class="pr-4 py-1 text-center">
                        <span class="text-blue-100 text-[10px] font-bold uppercase tracking-wider">Disponible Total</span>
                        <div class="flex justify-center items-baseline gap-1">
                            <h2 id="statPendiente" class="text-3xl font-bold mt-1">0.00</h2>
                            <span class="text-blue-200 text-xs font-medium uppercase">d√≠as</span>
                        </div>
                    </div>
                    <div class="pl-4 py-1 text-center">
                        <span class="text-blue-100 text-[10px] font-bold uppercase tracking-wider">Derecho Actual</span>
                        <div class="flex justify-center items-baseline gap-1">
                            <h2 id="currentAllowance" class="text-3xl font-bold mt-1">0</h2>
                            <span class="text-blue-200 text-xs font-medium uppercase">d√≠as</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mb-10">
            <h3 class="text-xs font-bold text-slate-400 uppercase mb-4 tracking-widest px-1">Historial de Uso</h3>
            <div id="emptyState" class="hidden text-center py-10 bg-white rounded-2xl border border-dashed border-slate-300">
                <p class="text-slate-400 text-sm italic">Toca + para registrar d√≠as</p>
            </div>
            <ul id="vacationList" class="space-y-3"></ul>
        </div>
    </div>

    <button onclick="toggleModal(true)" class="fixed bottom-6 right-6 w-16 h-16 bg-blue-600 text-white rounded-full shadow-2xl flex items-center justify-center text-3xl z-40 active:scale-90 transition-transform">Ôºã</button>

    <div id="settingsDrawer" class="drawer fixed inset-y-0 right-0 w-full max-w-xs bg-white shadow-2xl z-50 overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-xl font-bold text-slate-800">Ajustes</h2>
                <button onclick="toggleSettings(false)" class="text-3xl text-slate-400">&times;</button>
            </div>
            <section class="mb-8">
                <h3 class="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">D√≠as Laborales</h3>
                <div class="grid grid-cols-2 gap-2" id="workDaysContainer"></div>
            </section>
            <section class="mb-8">
                <h3 class="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">D√≠as Festivos (MM-DD Nombre)</h3>
                <div id="holidaysList" class="space-y-2 mb-3"></div>
                <div class="flex flex-col gap-2">
                    <input type="text" id="newHoliday" placeholder="Ej: 12-25 Navidad" class="bg-slate-100 p-3 rounded-xl text-sm outline-none">
                    <button onclick="addHoliday()" class="bg-blue-600 text-white py-3 rounded-xl text-sm font-bold">Agregar Festivo</button>
                </div>
            </section>
        </div>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-end sm:items-center justify-center z-50 p-4">
        <div class="bg-white rounded-3xl p-6 w-full max-w-md shadow-2xl">
            <h2 class="text-xl font-bold text-slate-800 mb-4">Registrar Periodo</h2>
            <div class="space-y-4">
                <input type="text" id="descInput" placeholder="Motivo" class="w-full p-4 rounded-xl bg-slate-50 outline-none">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Inicio</label>
                        <input type="date" id="dateStart" onchange="autoCalculateDays()" class="w-full p-3 rounded-xl bg-slate-50">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Fin</label>
                        <input type="date" id="dateEnd" onchange="autoCalculateDays()" class="w-full p-3 rounded-xl bg-slate-50">
                    </div>
                </div>
                <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100 text-center font-bold text-blue-600">
                    <span id="daysDisplay">0</span> d√≠as laborales
                </div>
            </div>
            <div class="mt-8 flex gap-3">
                <button onclick="toggleModal(false)" class="flex-1 p-4 text-slate-500 font-bold uppercase text-xs">Cerrar</button>
                <button onclick="addEntry()" class="flex-[2] py-4 bg-blue-600 text-white rounded-2xl font-bold">Guardar</button>
            </div>
        </div>
    </div>

    <script>
        const KEY = 'v_pro_stable_v3';
        const dayNames = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];

        let data = JSON.parse(localStorage.getItem(KEY)) || {
            hireDate: '',
            prevDays: 0,
            vacations: [],
            workDays: [1, 2, 3, 4, 5],
            holidays: ["01-01 A√±o Nuevo", "12-25 Navidad", "05-01 D√≠a del Trabajo", "09-16 D√≠a de la Independencia"]
        };

        // Registro del Service Worker para soporte Offline
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                .then(reg => console.log("SW registrado con √©xito", reg.scope))
                .catch(err => console.log("Fallo al registrar SW", err));
            });
        }

        function saveData() {
            data.hireDate = document.getElementById('hireDate').value;
            data.prevDays = parseFloat(document.getElementById('prevYearDays').value) || 0;
            localStorage.setItem(KEY, JSON.stringify(data));
            render();
        }

        function toggleSettings(show) {
            document.getElementById('settingsDrawer').classList.toggle('open', show);
        }

        function toggleModal(show) {
            document.getElementById('modal').classList.toggle('hidden', !show);
            if(show) {
                const hoy = new Date().toISOString().split('T')[0];
                document.getElementById('dateStart').value = hoy;
                document.getElementById('dateEnd').value = hoy;
                autoCalculateDays();
            }
        }

        function isHoliday(date) {
            const m = (date.getMonth() + 1).toString().padStart(2, '0');
            const d = date.getDate().toString().padStart(2, '0');
            const search = `${m}-${d}`;
            return data.holidays.some(h => h.startsWith(search));
        }

        function autoCalculateDays() {
            const startStr = document.getElementById('dateStart').value;
            const endStr = document.getElementById('dateEnd').value;
            if (!startStr || !endStr) return;
            let current = new Date(startStr + "T00:00:00");
            const end = new Date(endStr + "T00:00:00");
            let count = 0;
            while (current <= end) {
                if (data.workDays.includes(current.getDay()) && !isHoliday(current)) count++;
                current.setDate(current.getDate() + 1);
            }
            document.getElementById('daysDisplay').innerText = count;
        }

        function getAllowance(years) {
            if (years < 1) return 12; 
            const tabla = [12, 12, 14, 16, 18, 20, 22, 22, 22, 22, 22, 24];
            return tabla[Math.min(years, 11)];
        }

        function render() {
            document.getElementById('hireDate').value = data.hireDate;
            document.getElementById('prevYearDays').value = data.prevDays;

            if (data.hireDate) {
                const start = new Date(data.hireDate + "T00:00:00");
                const now = new Date();
                let years = now.getFullYear() - start.getFullYear();
                let months = now.getMonth() - start.getMonth();
                let days = now.getDate() - start.getDate();
                if (days < 0) { months--; days += new Date(now.getFullYear(), now.getMonth(), 0).getDate(); }
                if (months < 0) { years--; months += 12; }

                document.getElementById('antiquityDisplay').classList.remove('hidden');
                document.getElementById('antYears').innerText = years + 'a';
                document.getElementById('antMonths').innerText = months + 'm';
                document.getElementById('antDays').innerText = days + 'd';

                const allowance = getAllowance(years + 1);
                document.getElementById('currentAllowance').innerText = allowance;

                const lastAnniversary = new Date(now.getFullYear(), start.getMonth(), start.getDate());
                if (lastAnniversary > now) lastAnniversary.setFullYear(lastAnniversary.getFullYear() - 1);
                const earnedThisYear = (allowance / 365) * Math.floor((now - lastAnniversary) / 86400000);
                const used = data.vacations.reduce((acc, v) => acc + v.days, 0);

                document.getElementById('accrualBanner').classList.remove('hidden');
                document.getElementById('statPendiente').innerText = (data.prevDays + earnedThisYear - used).toFixed(2);
            }

            const list = document.getElementById('vacationList');
            const empty = document.getElementById('emptyState');
            if (data.vacations.length === 0) { list.innerHTML = ''; empty.classList.remove('hidden'); }
            else {
                empty.classList.add('hidden');
                list.innerHTML = data.vacations.sort((a,b) => new Date(b.start) - new Date(a.start)).map(v => `
                    <li onclick="this.classList.toggle('expanded')" class="group bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden cursor-pointer transition-all">
                        <div class="flex items-center justify-between p-4">
                            <div class="flex items-center gap-3">
                                <div class="bg-blue-50 text-blue-600 font-bold px-3 py-1 rounded-lg text-sm group-[.expanded]:bg-blue-600 group-[.expanded]:text-white transition-colors">-${v.days}</div>
                                <div><p class="font-bold text-slate-800 text-sm leading-tight">${v.desc}</p><p class="text-[10px] text-slate-400 font-bold uppercase">${v.start}</p></div>
                            </div>
                            <svg class="chevron w-4 h-4 text-slate-300 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </div>
                        <div class="details-content bg-slate-50 px-4 pb-4 pt-2 border-t border-slate-50 text-center">
                            <div class="flex justify-around mb-4 text-[11px] font-bold text-slate-500 uppercase tracking-tight">
                                <div><p class="text-slate-300 text-[9px]">Desde</p>${v.start}</div>
                                <div><p class="text-slate-300 text-[9px]">Hasta</p>${v.end}</div>
                            </div>
                            <button onclick="deleteEntry(event, ${v.id})" class="w-full py-2 bg-red-50 text-red-500 text-[10px] font-bold uppercase rounded-lg">Eliminar</button>
                        </div>
                    </li>
                `).join('');
            }

            document.getElementById('workDaysContainer').innerHTML = dayNames.map((name, idx) => `
                <button onclick="toggleWorkDay(${idx})" class="p-3 rounded-xl text-xs font-bold border transition-all ${data.workDays.includes(idx) ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-slate-400 border-slate-100'}">
                    ${name}
                </button>
            `).join('');

            document.getElementById('holidaysList').innerHTML = data.holidays.sort().map(h => {
                const [fecha, ...nombre] = h.split(' ');
                const etiqueta = nombre.join(' ') || 'Festivo';
                return `
                    <div class="flex justify-between items-center bg-slate-50 p-3 rounded-xl border border-slate-100">
                        <div class="flex flex-col text-left">
                            <span class="text-xs font-bold text-blue-600">${fecha}</span>
                            <span class="text-[11px] font-medium text-slate-600 uppercase tracking-tight">${etiqueta}</span>
                        </div>
                        <button onclick="removeHoliday('${h}')" class="text-red-400 text-[10px] font-bold uppercase ml-2">Quitar</button>
                    </div>
                `;
            }).join('');
        }

        function toggleWorkDay(idx) {
            if (data.workDays.includes(idx)) data.workDays = data.workDays.filter(d => d !== idx);
            else data.workDays.push(idx);
            saveData();
        }

        function addHoliday() {
            const input = document.getElementById('newHoliday');
            if (/^\d{2}-\d{2}/.test(input.value)) {
                if(!data.holidays.includes(input.value)) {
                    data.holidays.push(input.value);
                }
                input.value = '';
                saveData();
            } else {
                alert("Formato incorrecto. Usa MM-DD Nombre (Ej: 12-25 Navidad)");
            }
        }

        function removeHoliday(h) {
            data.holidays = data.holidays.filter(item => item !== h);
            saveData();
        }

        function addEntry() {
            const desc = document.getElementById('descInput').value || 'Vacaciones';
            const start = document.getElementById('dateStart').value;
            const end = document.getElementById('dateEnd').value;
            const days = parseInt(document.getElementById('daysDisplay').innerText);
            if(start && days > 0) {
                data.vacations.push({ id: Date.now(), desc, start, end, days });
                saveData();
                toggleModal(false);
                document.getElementById('descInput').value = '';
            }
        }

        function deleteEntry(e, id) {
            e.stopPropagation();
            if(confirm('¬øBorrar registro?')) { data.vacations = data.vacations.filter(v => v.id !== id); saveData(); }
        }

        window.onload = render;
    </script>
</body>
</html>
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-24">

    <nav class="bg-white border-b border-slate-200 px-4 py-3 sticky top-0 z-30">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <h1 class="text-lg font-bold text-slate-800">Vacaciones Pro üå¥</h1>
            <button onclick="toggleSettings(true)" class="p-2 bg-slate-100 rounded-full">‚öôÔ∏è</button>
        </div>
    </nav>

    <div class="max-w-md mx-auto px-4 pt-6">
        <header class="mb-6">
            <div id="antiquityDisplay" class="flex gap-2 items-center hidden">
                <span id="antYears" class="antiquity-badge">0a</span>
                <span id="antMonths" class="antiquity-badge">0m</span>
                <span id="antDays" class="antiquity-badge">0d</span>
            </div>
        </header>

        <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200 mb-6 grid grid-cols-2 gap-4">
            <div>
                <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Fecha Ingreso</label>
                <input type="date" id="hireDate" onchange="saveData()" class="text-sm font-semibold text-slate-700 w-full bg-slate-50 rounded-lg p-2 outline-none">
            </div>
            <div>
                <label class="block text-[10px] font-bold text-amber-600 uppercase mb-1">D√≠as A√±o Ant.</label>
                <input type="number" id="prevYearDays" value="0" step="0.5" onchange="saveData()" class="text-sm font-semibold text-amber-700 w-full bg-amber-50 rounded-lg p-2 outline-none">
            </div>
        </div>

        <div id="accrualBanner" class="hidden mb-6 text-white">
            <div class="bg-gradient-to-br from-blue-600 to-indigo-700 p-5 rounded-3xl shadow-xl">
                <div class="grid grid-cols-2 gap-0 divide-x divide-white/20">
                    <div class="pr-4 py-1 text-center">
                        <span class="text-blue-100 text-[10px] font-bold uppercase tracking-wider">Disponible Total</span>
                        <div class="flex justify-center items-baseline gap-1">
                            <h2 id="statPendiente" class="text-3xl font-bold mt-1">0.00</h2>
                            <span class="text-blue-200 text-xs font-medium uppercase">d√≠as</span>
                        </div>
                    </div>
                    <div class="pl-4 py-1 text-center">
                        <span class="text-blue-100 text-[10px] font-bold uppercase tracking-wider">Derecho Actual</span>
                        <div class="flex justify-center items-baseline gap-1">
                            <h2 id="currentAllowance" class="text-3xl font-bold mt-1">0</h2>
                            <span class="text-blue-200 text-xs font-medium uppercase">d√≠as</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mb-10">
            <h3 class="text-xs font-bold text-slate-400 uppercase mb-4 tracking-widest px-1">Historial de Uso</h3>
            <div id="emptyState" class="hidden text-center py-10 bg-white rounded-2xl border border-dashed border-slate-300">
                <p class="text-slate-400 text-sm italic">Toca + para registrar d√≠as</p>
            </div>
            <ul id="vacationList" class="space-y-3"></ul>
        </div>
    </div>

    <button onclick="toggleModal(true)" class="fixed bottom-6 right-6 w-16 h-16 bg-blue-600 text-white rounded-full shadow-2xl flex items-center justify-center text-3xl z-40 active:scale-90 transition-transform">Ôºã</button>

    <div id="settingsDrawer" class="drawer fixed inset-y-0 right-0 w-full max-w-xs bg-white shadow-2xl z-50 overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-xl font-bold text-slate-800">Ajustes</h2>
                <button onclick="toggleSettings(false)" class="text-3xl text-slate-400">&times;</button>
            </div>
            <section class="mb-8">
                <h3 class="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">D√≠as Laborales</h3>
                <div class="grid grid-cols-2 gap-2" id="workDaysContainer"></div>
            </section>
            <section class="mb-8">
                <h3 class="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">D√≠as Festivos (MM-DD Nombre)</h3>
                <div id="holidaysList" class="space-y-2 mb-3"></div>
                <div class="flex flex-col gap-2">
                    <input type="text" id="newHoliday" placeholder="Ej: 12-25 Navidad" class="bg-slate-100 p-3 rounded-xl text-sm outline-none">
                    <button onclick="addHoliday()" class="bg-blue-600 text-white py-3 rounded-xl text-sm font-bold">Agregar Festivo</button>
                </div>
            </section>
        </div>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-end sm:items-center justify-center z-50 p-4">
        <div class="bg-white rounded-3xl p-6 w-full max-w-md shadow-2xl">
            <h2 class="text-xl font-bold text-slate-800 mb-4">Registrar Periodo</h2>
            <div class="space-y-4">
                <input type="text" id="descInput" placeholder="Motivo" class="w-full p-4 rounded-xl bg-slate-50 outline-none">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Inicio</label>
                        <input type="date" id="dateStart" onchange="autoCalculateDays()" class="w-full p-3 rounded-xl bg-slate-50">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Fin</label>
                        <input type="date" id="dateEnd" onchange="autoCalculateDays()" class="w-full p-3 rounded-xl bg-slate-50">
                    </div>
                </div>
                <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100 text-center font-bold text-blue-600">
                    <span id="daysDisplay">0</span> d√≠as laborales
                </div>
            </div>
            <div class="mt-8 flex gap-3">
                <button onclick="toggleModal(false)" class="flex-1 p-4 text-slate-500 font-bold uppercase text-xs">Cerrar</button>
                <button onclick="addEntry()" class="flex-[2] py-4 bg-blue-600 text-white rounded-2xl font-bold">Guardar</button>
            </div>
        </div>
    </div>

    <script>
        const KEY = 'v_pro_stable_v3';
        const dayNames = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];

        let data = JSON.parse(localStorage.getItem(KEY)) || {
            hireDate: '',
            prevDays: 0,
            vacations: [],
            workDays: [1, 2, 3, 4, 5],
            holidays: ["01-01 A√±o Nuevo", "12-25 Navidad", "05-01 D√≠a del Trabajo", "09-16 D√≠a de la Independencia"]
        };

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(err => console.log("SW fail", err));
            });
        }

        function saveData() {
            data.hireDate = document.getElementById('hireDate').value;
            data.prevDays = parseFloat(document.getElementById('prevYearDays').value) || 0;
            localStorage.setItem(KEY, JSON.stringify(data));
            render();
        }

        function toggleSettings(show) {
            document.getElementById('settingsDrawer').classList.toggle('open', show);
        }

        function toggleModal(show) {
            document.getElementById('modal').classList.toggle('hidden', !show);
            if(show) {
                const hoy = new Date().toISOString().split('T')[0];
                document.getElementById('dateStart').value = hoy;
                document.getElementById('dateEnd').value = hoy;
                autoCalculateDays();
            }
        }

        function isHoliday(date) {
            const m = (date.getMonth() + 1).toString().padStart(2, '0');
            const d = date.getDate().toString().padStart(2, '0');
            const search = `${m}-${d}`;
            return data.holidays.some(h => h.startsWith(search));
        }

        function autoCalculateDays() {
            const startStr = document.getElementById('dateStart').value;
            const endStr = document.getElementById('dateEnd').value;
            if (!startStr || !endStr) return;
            let current = new Date(startStr + "T00:00:00");
            const end = new Date(endStr + "T00:00:00");
            let count = 0;
            while (current <= end) {
                if (data.workDays.includes(current.getDay()) && !isHoliday(current)) count++;
                current.setDate(current.getDate() + 1);
            }
            document.getElementById('daysDisplay').innerText = count;
        }

        function getAllowance(years) {
            if (years < 1) return 12; 
            const tabla = [12, 12, 14, 16, 18, 20, 22, 22, 22, 22, 22, 24];
            return tabla[Math.min(years, 11)];
        }

        function render() {
            document.getElementById('hireDate').value = data.hireDate;
            document.getElementById('prevYearDays').value = data.prevDays;

            if (data.hireDate) {
                const start = new Date(data.hireDate + "T00:00:00");
                const now = new Date();
                let years = now.getFullYear() - start.getFullYear();
                let months = now.getMonth() - start.getMonth();
                let days = now.getDate() - start.getDate();
                if (days < 0) { months--; days += new Date(now.getFullYear(), now.getMonth(), 0).getDate(); }
                if (months < 0) { years--; months += 12; }

                document.getElementById('antiquityDisplay').classList.remove('hidden');
                document.getElementById('antYears').innerText = years + 'a';
                document.getElementById('antMonths').innerText = months + 'm';
                document.getElementById('antDays').innerText = days + 'd';

                const allowance = getAllowance(years + 1);
                document.getElementById('currentAllowance').innerText = allowance;

                const lastAnniversary = new Date(now.getFullYear(), start.getMonth(), start.getDate());
                if (lastAnniversary > now) lastAnniversary.setFullYear(lastAnniversary.getFullYear() - 1);
                const earnedThisYear = (allowance / 365) * Math.floor((now - lastAnniversary) / 86400000);
                const used = data.vacations.reduce((acc, v) => acc + v.days, 0);

                document.getElementById('accrualBanner').classList.remove('hidden');
                document.getElementById('statPendiente').innerText = (data.prevDays + earnedThisYear - used).toFixed(2);
            }

            const list = document.getElementById('vacationList');
            const empty = document.getElementById('emptyState');
            if (data.vacations.length === 0) { list.innerHTML = ''; empty.classList.remove('hidden'); }
            else {
                empty.classList.add('hidden');
                list.innerHTML = data.vacations.sort((a,b) => new Date(b.start) - new Date(a.start)).map(v => `
                    <li onclick="this.classList.toggle('expanded')" class="group bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden cursor-pointer transition-all">
                        <div class="flex items-center justify-between p-4">
                            <div class="flex items-center gap-3">
                                <div class="bg-blue-50 text-blue-600 font-bold px-3 py-1 rounded-lg text-sm group-[.expanded]:bg-blue-600 group-[.expanded]:text-white transition-colors">-${v.days}</div>
                                <div><p class="font-bold text-slate-800 text-sm leading-tight">${v.desc}</p><p class="text-[10px] text-slate-400 font-bold uppercase">${v.start}</p></div>
                            </div>
                            <svg class="chevron w-4 h-4 text-slate-300 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </div>
                        <div class="details-content bg-slate-50 px-4 pb-4 pt-2 border-t border-slate-50 text-center">
                            <div class="flex justify-around mb-4 text-[11px] font-bold text-slate-500 uppercase tracking-tight">
                                <div><p class="text-slate-300 text-[9px]">Desde</p>${v.start}</div>
                                <div><p class="text-slate-300 text-[9px]">Hasta</p>${v.end}</div>
                            </div>
                            <button onclick="deleteEntry(event, ${v.id})" class="w-full py-2 bg-red-50 text-red-500 text-[10px] font-bold uppercase rounded-lg">Eliminar</button>
                        </div>
                    </li>
                `).join('');
            }

            document.getElementById('workDaysContainer').innerHTML = dayNames.map((name, idx) => `
                <button onclick="toggleWorkDay(${idx})" class="p-3 rounded-xl text-xs font-bold border transition-all ${data.workDays.includes(idx) ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-slate-400 border-slate-100'}">
                    ${name}
                </button>
            `).join('');

            // Renderizado de lista de festivos con etiquetas
            document.getElementById('holidaysList').innerHTML = data.holidays.sort().map(h => {
                const [fecha, ...nombre] = h.split(' ');
                const etiqueta = nombre.join(' ') || 'Festivo';
                return `
                    <div class="flex justify-between items-center bg-slate-50 p-3 rounded-xl border border-slate-100">
                        <div class="flex flex-col text-left">
                            <span class="text-xs font-bold text-blue-600">${fecha}</span>
                            <span class="text-[11px] font-medium text-slate-600 uppercase tracking-tight">${etiqueta}</span>
                        </div>
                        <button onclick="removeHoliday('${h}')" class="text-red-400 text-[10px] font-bold uppercase ml-2">Quitar</button>
                    </div>
                `;
            }).join('');
        }

        function toggleWorkDay(idx) {
            if (data.workDays.includes(idx)) data.workDays = data.workDays.filter(d => d !== idx);
            else data.workDays.push(idx);
            saveData();
        }

        function addHoliday() {
            const input = document.getElementById('newHoliday');
            if (/^\d{2}-\d{2}/.test(input.value)) {
                if(!data.holidays.includes(input.value)) {
                    data.holidays.push(input.value);
                }
                input.value = '';
                saveData();
            } else {
                alert("Formato incorrecto. Usa MM-DD Nombre (Ej: 12-25 Navidad)");
            }
        }

        function removeHoliday(h) {
            data.holidays = data.holidays.filter(item => item !== h);
            saveData();
        }

        function addEntry() {
            const desc = document.getElementById('descInput').value || 'Vacaciones';
            const start = document.getElementById('dateStart').value;
            const end = document.getElementById('dateEnd').value;
            const days = parseInt(document.getElementById('daysDisplay').innerText);
            if(start && days > 0) {
                data.vacations.push({ id: Date.now(), desc, start, end, days });
                saveData();
                toggleModal(false);
                document.getElementById('descInput').value = '';
            }
        }

        function deleteEntry(e, id) {
            e.stopPropagation();
            if(confirm('¬øBorrar registro?')) { data.vacations = data.vacations.filter(v => v.id !== id); saveData(); }
        }

        window.onload = render;
    </script>
</body>
</html>
